		Ricochet Robots Game Protocol (RRGP)
		        Keith Packard
		      keithp@keithp.com
		         Carl Worth
		        cworth@isi.edu
			   2003-5-27
		$RCSId: $

Introduction

RRGP is a network protocol for playing the ricochet robots game.  It permits
a single server to host multiple games with named participants.  The
protocol is designed so that people can play using only telnet, but it is
expected that graphical interfaces will be able to drive the protocol as
well.

RRGP borrows ideas from other network protocols like SMTP using a
synchronous command interface.

Document Conventions

	All commands include a response (yeah, synchronous protocols are
	bad.  tough)

	<command> <args> 

	->

	<response>

	<response> is one of:

	<command> <args>
	ERROR <message>

1. Requests

1.1 Connection setup

	The RRGP server has no well defined port; agreement on which port to
	use must be done through some external mechanism.  Once connected,
	the client must identify itself:
	
	HELO <username>
	
	->
	
	HELO <servername>

1.2. Listing available users

	WHO

	->

	WHO <username1> <username2> ...

1.3. Listing available games

	GAMES

	->

	GAMES <game1> <game2> ...

1.4. Listing users in a game

	USERS <game>

	->

	USERS <username1> <score1> <username2> <score2> ...

1.5. Creating a new game

	NEW <game-suggestion>

	->

	NEW <game>

1.6. Joining an existing game

	JOIN <game>

	->

	JOIN

	Possible errors: NOGAME

1.7. Watching an existing game

	WATCH <game>

	->

	WATCH

	The client will monitor the game, but not be listed in the
	userlist nor be allowed to make moves.

	Possible errors: NOGAME

1.8. Get the game contents

	SHOW

	->

	SHOW <game-board>

	<game-board> is a quoted multi-line string containing an
	diagram of the game contents, (an array of cells). A single
	cell and its surrounding are indicated as:

	 HH 
	VcsV
	VrrV
	 HH

	H = ' ' or '='
	V = ' ' or '|'
	c = '.' or <target-color> (one of 'r', 'g', 'b', or 'y')
	s = '.' or <target-shape> (one of 'c', 's', 'o', or 't')
	r = '.' or <robot-color>  (one of 'r', 'g', 'b', or 'y')

	The goal robot and target (color and shape) are indicated with
	capital letters.

	For example:

	SHOW "
	 ==
	|.. .. gs
	|RR .. ..
	
	 ..|.. RT|
	 gg|.. ..|
	 ==    =="

	RR = 	Red robot (goal robot)
	gs = 	Green square (non-goal target)
	gg = 	Green robot (non-goal target)
	RT =	Red triangle (goal target)

	Possible errors: NOTINGAME

1.9. Bid

	BID <number>

	->

	BID <number>

	Possible errors: NOTINGAME, TIMEOUT

1.10. Move

	MOVE <color> <dir>

	->

	MOVE

	<color> is one of 'R', 'Y', 'G' or 'B', <dir> is one of 'N', 'E',
	'S' or 'W'.

	Possible errors: NOTINGAME, NOTACTIVE

1.12. Undo

	UNDO

	->

	UNDO

	Undoes the last move

	Possible errors: NOTINGAME, NOTACTIVE

1.13. Reset

	RESET

	->

	RESET

	Resets robot positions to that at the start of the turn.

	Possible errors: NOTINGAME, NOTACTIVE

1.14. Next turn

	TURN

	->

	TURN

	Advance the game to the next turn, (which will have a new
	target square). The robots will start in their final positions
	at the end of the first successfully demonstrated solution.

	If a solution has been demonstrated, or if all users with
	active bids have issued PASS then a TURN request from a single
	user has immediate effect. Otherwise, the server requires a
	TURN request from each active user before it will ABANDON the
	current turn.

	Possible errors: NOTINGAME

1.15. Pass the bid to the next lowest bidder

	PASS

	->

	PASS

	Possible errors: NOTINGAME

1.16. Message

	MESSAGE <text>

	->
	
	MESSAGE

	Possible errors: NOTINGAME

2. Asynchronous notification.  

	The server will send notices to each user in a game whenever
        there is a move. It will also send notices to every connected
        client when additional people join or new games are
        started. These are of the form:

	NOTICE <notice-code> <args>

2.1. Move notice

	NOTICE MOVE <color> <dir>

2.2. New users

	NOTICE USER <username>

2.3. Disconnected user

	NOTICE PART <username>

2.4. New games

	NOTICE GAME <game>

2.5. Terminated games

	NOTICE TERMINATE <game>

2.6. Bids

	NOTICE BID <username> <number>

2.7. Timer

	NOTICE TIME <seconds>

	Timer ticks are sent every 10 seconds

2.8. Select active player

	NOTICE ACTIVE <username>

	Only the active player may move the robots

2.9. Undo

	NOTICE UNDO

2.11. Reset

	NOTICE RESET

2.12. Next turn

	NOTICE TURN <color> <shape>

2.13. Message

	NOTICE MESSAGE <text>

2.14. Abandon request

	NOTICE ABANDON <username>

	<username> has requested that the current turn be abandoned
	(i.e. TURN requested without a solution demonstrated)
	If all active users in the current game make a TURN
	request, then the turn is abandoned and the next turn
	selected with the robots reset to their position before the
	turn started.

3. Errors

	The following error codes may be returned.

3.1. No such game

	ERROR NOGAME

	A game name was provided that does not exist.

3.1. Not in game

	ERROR NOTINGAME

	A game playing command was made, but the user is not a
	particpant of any game.

	Possibly returned by: SHOW, MOVE, RESET, UNDO, TURN, PASS,
	MESSAGE.

3.2. Time out

	ERROR TIMEOUT

	A bid was submitted after the timer expired.

	Possibly returned by: BID

3.3. Not active

	ERROR NOTACTIVE

	A move, undo or reset was submitted by other than the
	active user.
	
	Possibly returned by: MOVE, RESET, UNDO

Some comments/questions
-----------------------

>> Hmmm... looks like a user can only be in a single game (would need to
>> fix SHOW, BID, MOVE, RESET, TURN, NOTICE, etc.)

> Yup.

It doesn't seem right to support multiple games in a single server yet
not allow the same user to JOIN or WATCH more than one game
simultaneously.

Or is the idea that I connect as cworth1, cworth2, etc.? (ugh)

--

The server manages ACTIVE based on bids, scores, and PASS
requests. Once a turn is over, (solution demonstrated or all bidding
users PASS), it would be nice to allow others to show alternate
solutions, failed attempts, etc. Shall we provide a way for the ACTIVE
user to pass control to another, (only when a turn is over)? Or maybe
since the turn is over we just let any user move the pieces?

